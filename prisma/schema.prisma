generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
  binaryTargets   = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  relationMode      = "prisma"
}

model User {
  id                      String            @id(map: "User_pkey") @default(cuid())
  email                   String            @unique(map: "User_email_key")
  password                String
  name                    String
  role                    String            @default("admin")
  createdAt               DateTime          @default(now()) @db.Timestamp(6)
  updatedAt               DateTime          @default(now()) @updatedAt @db.Timestamp(6)
  adminApprovedScripts    VoiceoverScript[] @relation("AdminApprover")
  producerApprovedScripts VoiceoverScript[] @relation("ProducerApprover")

  @@map("users")
}

model Streamer {
  id                String             @id @default(cuid())
  name              String
  profilePhoto      String?
  email             String?            @unique
  phone             String?
  iban              String?
  password          String?
  loginToken        String?            @unique
  platform          String             @default("Twitch")
  channelUrl        String?
  hourlyRate        Float              @default(0)
  commissionRate    Float              @default(0)
  isActive          Boolean            @default(true)
  notes             String?
  createdAt         DateTime           @default(now()) @db.Timestamp(6)
  updatedAt         DateTime           @default(now()) @updatedAt @db.Timestamp(6)
  contentRegistries ContentRegistry[]
  externalStreams   ExternalStream[]
  financialRecords  FinancialRecord[]
  payments          Payment[]
  streams           Stream[]
  teamRates         StreamerTeamRate[]
}

model StreamerTeamRate {
  id         String   @id @default(cuid())
  streamerId String
  teamName   String
  hourlyRate Float
  createdAt  DateTime @default(now()) @db.Timestamp(6)
  updatedAt  DateTime @default(now()) @updatedAt @db.Timestamp(6)
  streamer   Streamer @relation(fields: [streamerId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([streamerId, teamName])
}

model Stream {
  id              String   @id @default(cuid())
  streamerId      String
  date            DateTime @db.Timestamp(6)
  duration        Int
  matchInfo       String?
  teamName        String?
  totalRevenue    Float    @default(0)
  streamerEarning Float    @default(0)
  arhavalProfit   Float    @default(0)
  teams           String?
  cost            Float    @default(0)
  status          String   @default("pending")
  paymentStatus   String   @default("pending")
  notes           String?
  createdAt       DateTime @default(now()) @db.Timestamp(6)
  updatedAt       DateTime @default(now()) @updatedAt @db.Timestamp(6)
  streamer        Streamer @relation(fields: [streamerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ExternalStream {
  id         String   @id @default(cuid())
  streamerId String
  teamName   String
  date       DateTime @db.Timestamp(6)
  duration   Int
  payment    Float
  notes      String?
  createdAt  DateTime @default(now()) @db.Timestamp(6)
  updatedAt  DateTime @default(now()) @updatedAt @db.Timestamp(6)
  streamer   Streamer @relation(fields: [streamerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model ContentCreator {
  id                String            @id @default(cuid())
  name              String
  profilePhoto      String?
  email             String?           @unique
  phone             String?
  password          String?
  loginToken        String?           @unique
  platform          String?
  channelUrl        String?
  isActive          Boolean           @default(true)
  notes             String?
  createdAt         DateTime          @default(now()) @db.Timestamp(6)
  updatedAt         DateTime          @default(now()) @updatedAt @db.Timestamp(6)
  iban              String?
  contents          Content[]
  contentRegistries ContentRegistry[]
  financialRecords  FinancialRecord[]
  scripts           VoiceoverScript[]
}

model Content {
  id              String           @id @default(cuid())
  title           String
  type            String
  platform        String
  url             String?
  publishDate     DateTime         @db.Timestamp(6)
  creatorId       String?
  creatorName     String?
  views           Int              @default(0)
  likes           Int              @default(0)
  comments        Int              @default(0)
  shares          Int              @default(0)
  saves           Int              @default(0)
  notes           String?
  createdAt       DateTime         @default(now()) @db.Timestamp(6)
  updatedAt       DateTime         @default(now()) @updatedAt @db.Timestamp(6)
  creator         ContentCreator?  @relation(fields: [creatorId], references: [id], onUpdate: NoAction)
  contentRegistry ContentRegistry?
}

model VoiceActor {
  id                String            @id @default(cuid())
  name              String
  profilePhoto      String?
  email             String?           @unique
  phone             String?
  password          String?
  loginToken        String?           @unique
  isActive          Boolean           @default(true)
  notes             String?
  createdAt         DateTime          @default(now()) @db.Timestamp(6)
  updatedAt         DateTime          @default(now()) @updatedAt @db.Timestamp(6)
  iban              String?
  contentRegistries ContentRegistry[]
  financialRecords  FinancialRecord[]
  scripts           VoiceoverScript[]
}

model VoiceoverScript {
  id                 String                @id @default(cuid())
  title              String
  text               String
  creatorId          String?
  voiceActorId       String?
  audioFile          String?
  price              Float?
  contentType        String?
  notes              String?
  createdAt          DateTime              @default(now()) @db.Timestamp(6)
  updatedAt          DateTime              @default(now()) @updatedAt @db.Timestamp(6)
  status             VoiceoverScriptStatus @default(WAITING_VOICE)
  rejectionReason    String?
  voiceLink          String?
  producerApproved   Boolean               @default(false)
  producerApprovedAt DateTime?
  producerApprovedBy String?
  adminApproved      Boolean               @default(false)
  adminApprovedAt    DateTime?
  adminApprovedBy    String?
  contentRegistry    ContentRegistry?
  editPack           EditPack?
  adminApprover      User?                 @relation("AdminApprover", fields: [adminApprovedBy], references: [id], onUpdate: NoAction)
  creator            ContentCreator?       @relation(fields: [creatorId], references: [id], onUpdate: NoAction)
  producerApprover   User?                 @relation("ProducerApprover", fields: [producerApprovedBy], references: [id], onUpdate: NoAction)
  voiceActor         VoiceActor?           @relation(fields: [voiceActorId], references: [id], onUpdate: NoAction)
}

model FinancialRecord {
  id               String          @id @default(cuid())
  type             String
  category         String
  amount           Float
  description      String?
  date             DateTime        @db.Timestamp(6)
  streamerId       String?
  streamId         String?
  createdAt        DateTime        @default(now()) @db.Timestamp(6)
  updatedAt        DateTime        @default(now()) @updatedAt @db.Timestamp(6)
  teamMemberId     String?
  contentCreatorId String?
  voiceActorId     String?
  occurredAt       DateTime?       @default(now()) @db.Timestamp(6)
  entryType        String?         @default("expense")
  direction        String?         @default("OUT")
  relatedPaymentId String?
  contentCreator   ContentCreator? @relation(fields: [contentCreatorId], references: [id], onUpdate: NoAction)
  streamer         Streamer?       @relation(fields: [streamerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teamMember       TeamMember?     @relation(fields: [teamMemberId], references: [id], onUpdate: NoAction)
  voiceActor       VoiceActor?     @relation(fields: [voiceActorId], references: [id], onUpdate: NoAction)

  @@index([occurredAt])
  @@index([entryType])
  @@index([entryType, occurredAt])
  @@index([direction])
  @@index([teamMemberId])
  @@index([contentCreatorId])
  @@index([voiceActorId])
  @@index([streamerId, occurredAt])
  @@index([teamMemberId, occurredAt])
  @@index([contentCreatorId, occurredAt])
  @@index([voiceActorId, occurredAt])
}

model Payment {
  id          String    @id @default(cuid())
  streamerId  String
  amount      Float
  type        String
  period      String
  description String?
  paidAt      DateTime? @db.Timestamp(6)
  createdAt   DateTime  @default(now()) @db.Timestamp(6)
  updatedAt   DateTime  @default(now()) @updatedAt @db.Timestamp(6)
  streamer    Streamer  @relation(fields: [streamerId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([streamerId])
  @@index([streamerId, paidAt])
  @@index([paidAt])
  @@index([period])
}

model TeamMember {
  id                String            @id @default(cuid())
  name              String
  email             String?           @unique
  phone             String?
  password          String?
  iban              String?
  role              String
  baseSalary        Float             @default(0)
  isActive          Boolean           @default(true)
  notes             String?
  createdAt         DateTime          @default(now()) @db.Timestamp(6)
  updatedAt         DateTime          @default(now()) @updatedAt @db.Timestamp(6)
  contentRegistries ContentRegistry[]
  financialRecords  FinancialRecord[]
  tasks             Task[]
  payments          TeamPayment[]
}

model Task {
  id           String     @id @default(cuid())
  teamMemberId String
  title        String
  description  String?
  status       String     @default("pending")
  priority     String     @default("medium")
  dueDate      DateTime?  @db.Timestamp(6)
  completedAt  DateTime?  @db.Timestamp(6)
  createdAt    DateTime   @default(now()) @db.Timestamp(6)
  updatedAt    DateTime   @default(now()) @updatedAt @db.Timestamp(6)
  teamMember   TeamMember @relation(fields: [teamMemberId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model TeamPayment {
  id           String     @id @default(cuid())
  teamMemberId String
  amount       Float
  type         String
  period       String
  description  String?
  paidAt       DateTime?  @db.Timestamp(6)
  createdAt    DateTime   @default(now()) @db.Timestamp(6)
  updatedAt    DateTime   @default(now()) @updatedAt @db.Timestamp(6)
  teamMember   TeamMember @relation(fields: [teamMemberId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([teamMemberId])
  @@index([teamMemberId, paidAt])
  @@index([paidAt])
  @@index([period])
}

model Payout {
  id            String    @id @default(cuid())
  recipientType String
  recipientId   String
  amount        Float
  status        String    @default("paid")
  source        String    @default("manual")
  referenceId   String?
  note          String?
  paidAt        DateTime? @db.Timestamp(6)
  createdAt     DateTime  @default(now()) @db.Timestamp(6)
  updatedAt     DateTime  @default(now()) @updatedAt @db.Timestamp(6)

  @@index([recipientType, recipientId])
  @@index([recipientType, recipientId, createdAt])
  @@index([status, createdAt])
  @@index([paidAt])
}

model MonthlyPlan {
  id        String   @id @default(cuid())
  title     String
  target    Float
  month     String
  type      String
  createdAt DateTime @default(now()) @db.Timestamp(6)
  updatedAt DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@unique([type, month])
}

model YearlyGoal {
  id           String   @id @default(cuid())
  title        String
  target       Float
  year         Int
  type         String
  isCurrency   Boolean  @default(false)
  isPercentage Boolean  @default(false)
  createdAt    DateTime @default(now()) @db.Timestamp(6)
  updatedAt    DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@unique([type, year])
}

model SocialMediaStats {
  id            String   @id @default(cuid())
  month         String?
  platform      String
  followerCount Int
  target        Int?
  createdAt     DateTime @default(now()) @db.Timestamp(6)
  updatedAt     DateTime @default(now()) @updatedAt @db.Timestamp(6)
  week          String?

  @@unique([month, week, platform])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  userName   String?
  userRole   String?
  action     String
  entityType String?
  entityId   String?
  oldValue   String?
  newValue   String?
  details    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@index([userRole])
}

model EditPack {
  id          String          @id @default(cuid())
  voiceoverId String          @unique
  token       String          @unique
  editorNotes String?
  assetsLinks String?
  createdAt   DateTime        @default(now())
  expiresAt   DateTime
  voiceover   VoiceoverScript @relation(fields: [voiceoverId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([expiresAt])
  @@index([voiceoverId])
}

model Todo {
  id        String   @id @default(cuid())
  text      String
  completed Boolean  @default(false)
  notes     String?
  createdAt DateTime @default(now()) @db.Timestamp(6)
  updatedAt DateTime @default(now()) @updatedAt @db.Timestamp(6)

  @@index([completed])
  @@index([createdAt])
}

model ContentRegistry {
  id                String                @id @default(cuid())
  title             String
  description       String?
  status            ContentRegistryStatus @default(DRAFT)
  creatorId         String?
  voiceActorId      String?
  editorId          String?
  voiceoverScriptId String?               @unique
  contentId         String?               @unique
  platform          String?
  contentType       String?
  scriptLink        String?
  voiceLink         String?
  editLink          String?
  finalLink         String?
  scriptDeadline    DateTime?
  voiceDeadline     DateTime?
  editDeadline      DateTime?
  publishDate       DateTime?
  notes             String?
  editorNotes       String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @default(now()) @updatedAt
  scriptText        String?
  streamerId        String?
  voicePrice        Float?
  editPrice         Float?
  voicePaid         Boolean?              @default(false)
  editPaid          Boolean?              @default(false)
  content           Content?              @relation(fields: [contentId], references: [id])
  creator           ContentCreator?       @relation(fields: [creatorId], references: [id])
  editor            TeamMember?           @relation(fields: [editorId], references: [id])
  streamer          Streamer?             @relation(fields: [streamerId], references: [id], onUpdate: NoAction)
  voiceActor        VoiceActor?           @relation(fields: [voiceActorId], references: [id])
  voiceoverScript   VoiceoverScript?      @relation(fields: [voiceoverScriptId], references: [id])

  @@index([status])
  @@index([creatorId])
  @@index([voiceActorId])
  @@index([streamerId])
  @@index([editorId])
  @@index([platform])
  @@index([createdAt])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model arhaval_predictions {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String            @db.Uuid
  question_id       String
  stream_id         String
  answer_index      Int
  is_correct        Boolean?
  points_earned     Int?              @default(0)
  created_at        DateTime?         @default(now()) @db.Timestamptz(6)
  arhaval_questions arhaval_questions @relation(fields: [question_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  arhaval_streams   arhaval_streams   @relation(fields: [stream_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  arhaval_users     arhaval_users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, question_id])
  @@index([question_id], map: "idx_predictions_question")
  @@index([user_id], map: "idx_predictions_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model arhaval_questions {
  id                  String                @id
  stream_id           String
  question            String
  type                String
  options             Json
  team_logos          Json?
  team1_name          String?
  team2_name          String?
  team1_players       Json?
  team2_players       Json?
  correct_answer      Int?
  points              Int?                  @default(10)
  status              String?               @default("pending")
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  is_locked           Boolean?              @default(false)
  arhaval_predictions arhaval_predictions[]
  arhaval_streams     arhaval_streams       @relation(fields: [stream_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_questions_status")
  @@index([stream_id], map: "idx_questions_stream")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model arhaval_settings {
  key        String    @id
  value      String
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model arhaval_streams {
  id                  String                @id
  title               String
  description         String?
  date                DateTime              @db.Timestamptz(6)
  status              String?               @default("upcoming")
  team1_name          String?
  team1_logo          String?
  team2_name          String?
  team2_logo          String?
  stream_url          String?
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  arhaval_predictions arhaval_predictions[]
  arhaval_questions   arhaval_questions[]

  @@index([date(sort: Desc)], map: "idx_streams_date")
  @@index([status], map: "idx_streams_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model arhaval_users {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username            String                @unique
  email               String?
  password            String?
  platform            String?
  platform_url        String?
  platform_user_id    String?
  avatar_url          String?
  score               Int?                  @default(0)
  total_points        Int?                  @default(0)
  rank                Int?                  @default(0)
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  arhaval_predictions arhaval_predictions[]

  @@index([score(sort: Desc)], map: "idx_users_score")
  @@index([username], map: "idx_users_username")
}

enum VoiceoverScriptStatus {
  WAITING_VOICE
  VOICE_UPLOADED
  APPROVED
  REJECTED
  PAID
  ARCHIVED
}

enum ContentRegistryStatus {
  WAITING_SCRIPT
  DRAFT
  SCRIPT_READY
  VOICE_READY
  EDITING
  REVIEW
  PUBLISHED
  ARCHIVED
}
